<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>SKYRHRG Proxy Installer</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css" crossorigin="anonymous" />
	<style>
		body { background: #000; color: #000; font-family: 'Segoe UI', sans-serif; }
		header { background: rgb(111, 0, 255); color: #fff; padding: 1rem; text-align: center; font-weight: 700; }
		.gradient-text { background: linear-gradient(45deg, #de40ff, #2d00a8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
		.container { position: relative; z-index: 1; }
		.container::before { content: ""; position: absolute; top: -10px; left: -10px; right: -10px; bottom: -10px; z-index: -1; border-radius: 25px; background: rgba(0, 123, 255, 0.4); filter: blur(50px); box-shadow: 0 0 30px rgb(60,0,227); }
		#statusBox { background: #000; color: #0f0; padding: 15px; font-family: monospace; border-radius: 5px; display: none; margin-top: 20px; white-space: pre-wrap; }
		footer { background: #f1f1f1; text-align: center; padding: 0.75rem 0; font-size: 0.875rem; color: #666; margin-top: 2rem; }
		button { background: linear-gradient(45deg, #de40ff, #2d00a8); color: white; border: none; border-radius: 8px; padding: 10px 16px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease-in-out; }
		button:hover { background: linear-gradient(45deg, #2d00a8, #de40ff); box-shadow: 0 4px 15px rgba(222, 64, 255, 0.5); }
		small.note { color: #666; display: block; margin-top: -8px; margin-bottom: 10px; font-size: 13px; }
	</style>
</head>
<body>
	<header>‚ö° SKYRHRG Proxy Installer</header>
	<main class="container my-5" style="max-width: 600px;">
		<div class="bg-white p-4 rounded-3 shadow">
			<h2 class="text-center mb-4 gradient-text" style="font-weight:700;">üõ†Ô∏è Create Proxy</h2>
			<form id="proxyForm" method="POST" autocomplete="off">
				<input type="hidden" name="csrf_token" id="csrf_token" value="">
				<input type="hidden" name="fp" id="fp" value="">
				<div class="mb-3">
					<label for="ip" class="form-label">Server IP</label>
					<input type="text" name="ip" id="ip" class="form-control" required />
				</div>
				<div class="mb-3">
					<label for="username" class="form-label">Root Username</label>
					<input type="text" name="username" id="username" value="root" class="form-control" required />
				</div>
				<div class="mb-3">
					<label for="password" class="form-label">Root Password</label>
					<input type="text" name="password" id="password" class="form-control" required />
				</div>
				<div class="mb-3">
					<label for="proxy_user" class="form-label">Proxy Username</label>
					<input type="text" name="proxy_user" id="proxy_user" pattern="[a-z0-9]{6,}" title="Only lowercase letters and numbers, min 6 characters" placeholder="e.g. user123" class="form-control" required />
					<small class="note">Only lowercase letters and numbers (min 6 characters)</small>
				</div>
				<div class="mb-3">
					<label for="proxy_pass" class="form-label">Proxy Password</label>
					<input type="text" name="proxy_pass" id="proxy_pass" pattern="[a-z0-9]{6,}" title="Only lowercase letters and numbers, min 6 characters" placeholder="e.g. pass789" class="form-control" required />
					<small class="note">Only lowercase letters and numbers (min 6 characters)</small>
				</div>
				<div class="mb-4">
					<label for="port" class="form-label">Port</label>
					<select name="port" id="port" class="form-select" required>
						<option value="3128">3128</option>
						<option value="5515">5515</option>
						<option value="8080">8080</option>
						<option value="8000">8000</option>
						<option value="5050">5050</option>
					</select>
				</div>
				<div class="d-grid">
					<button type="submit" id="submitBtn" class="btn btn-success btn-lg">
						<i class="fas fa-rocket me-2"></i> Create Proxy
					</button>
				</div>
			</form>
			<pre id="statusBox"></pre>
			<div id="copyBox"></div>
		</div>
	</main>
	<footer>¬© 2025 SKYRHRG Proxy Installer</footer>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		const fp = btoa(navigator.userAgent + screen.width + screen.height + navigator.language);
		document.getElementById('fp').value = fp;
		const initFormData = new URLSearchParams();
		initFormData.append('fp', fp);
		fetch('/api/csrf/init', { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: initFormData })
			.then(r => r.json())
			.then(d => { document.getElementById('csrf_token').value = d.token || ''; });

		document.getElementById('proxyForm').addEventListener('submit', function(e) {
			e.preventDefault();
			const formData = new FormData(this);
			const statusBox = document.getElementById('statusBox');
			const copyBox = document.getElementById('copyBox');
			const submitBtn = document.getElementById('submitBtn');
			statusBox.style.display = 'block';
			statusBox.innerText = 'üîÅ Starting...\n';
			copyBox.innerHTML = '';
			submitBtn.disabled = true;

			const xhr = new XMLHttpRequest();
			xhr.open('POST', '/api/proxy/create', true);
			xhr.onprogress = function() {
				const lines = xhr.responseText.trim().split('\n');
				const last = lines[lines.length - 1];
				if (last && last.startsWith('COPY::')) {
					const colonProxy = last.replace('COPY::', '').trim();
					const [ip, port, user, pass] = colonProxy.split(':');
					const browserProxy = `http://${user}:${pass}@${ip}:${port}`;
					statusBox.innerText += `\n‚úÖ Proxy created successfully.\n\nüîó Colon Format:\n${colonProxy}\n\nüîó Browser Format:\n${browserProxy}`;
					copyBox.innerHTML = `<div class="mb-4"><input class="form-select" type="text" value="${colonProxy}" id="proxyInput" readonly><button onclick="copyProxy()">üìã Copy Colon Format</button><br><br></div><div class="mb-4"><input type="text" class="form-select" value="${browserProxy}" readonly></div>`;
					document.getElementById('proxyInput').focus();
				} else {
					statusBox.innerText = lines.join('\n');
				}
			};
			xhr.onloadend = function() { submitBtn.disabled = false; };
			xhr.onerror = function() { statusBox.innerText += '\n‚ùå Network error. Please try again.'; submitBtn.disabled = false; };
			xhr.send(formData);
		});

		function copyProxy() {
			const input = document.getElementById('proxyInput');
			input.select();
			document.execCommand('copy');
			alert('‚úÖ Proxy copied!');
		}
	</script>
</body>
</html>